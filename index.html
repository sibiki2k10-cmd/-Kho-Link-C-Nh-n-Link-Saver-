<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Link Saver üîó</title>
    <style>
        :root { --primary: #6c5ce7; --bg: #dfe6e9; --card: #fff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 600px; }
        
        /* Login Form */
        #login-screen { background: var(--card); padding: 40px; border-radius: 10px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-top: 50px; }
        
        /* Dashboard */
        .hidden { display: none; }
        .input-group { background: var(--card); padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #b2bec3; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:hover { opacity: 0.9; }
        
        /* Link Card */
        .link-card { background: var(--card); padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 5px solid var(--primary); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .link-info h3 { margin: 0 0 5px 0; font-size: 1.1rem; color: #2d3436; }
        .link-meta { font-size: 0.85rem; color: #636e72; }
        .tag { background: #ffeaa7; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; color: #d35400; margin-right: 5px; }
        
        .actions a { text-decoration: none; background: #00b894; color: white; padding: 5px 10px; border-radius: 4px; font-size: 0.9rem; margin-right: 5px; }
        .btn-del { background: #fab1a0; color: #d63031; padding: 5px 10px; border-radius: 4px; cursor: pointer; border: none; }
    </style>
</head>
<body>

    <div class="container">
        <div id="login-screen">
            <h2>üîê Kho Link C√° Nh√¢n</h2>
            <input type="text" id="user" placeholder="Username">
            <input type="password" id="pass" placeholder="Password">
            <button onclick="login()">Truy c·∫≠p</button>
            <p id="msg" style="color:red; margin-top:10px"></p>
        </div>

        <div id="app" class="hidden">
            <div class="input-group">
                <h3>Th√™m Link M·ªõi</h3>
                <input type="text" id="linkTitle" placeholder="Ti√™u ƒë·ªÅ (Vd: Nh·∫°c Lofi chill)">
                <input type="url" id="linkUrl" placeholder="D√°n URL v√†o ƒë√¢y (https://...)">
                <select id="linkCategory">
                    <option value="C√¥ng vi·ªác">üíº C√¥ng vi·ªác</option>
                    <option value="H·ªçc t·∫≠p">üìö H·ªçc t·∫≠p</option>
                    <option value="Gi·∫£i tr√≠">üé¨ Gi·∫£i tr√≠</option>
                    <option value="T√†i li·ªáu">üìÇ T√†i li·ªáu</option>
                </select>
                <button onclick="addLink()">üíæ L∆∞u Link</button>
            </div>

            <div id="link-list">
                <p style="text-align:center">ƒêang t·∫£i d·ªØ li·ªáu...</p>
            </div>
        </div>
    </div>

    <script>
        // --- D√ÅN LINK SCRIPT M·ªöI V√ÄO ƒê√ÇY ---
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby2JJg-pk0oM0cGtyeUBlLTXB9QPIqmSGfq3CMZ54c5Wfc9tKHIn_ZG5k1f2Itp7uLv/exec'; 

        function login() {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;
            document.getElementById('msg').innerText = "ƒêang ki·ªÉm tra...";

            const fd = new FormData();
            fd.append('action', 'login');
            fd.append('user', u);
            fd.append('pass', p);

            fetch(SCRIPT_URL, { method: 'POST', body: fd })
            .then(res => res.json())
            .then(data => {
                if(data.status == 'success') {
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('app').classList.remove('hidden');
                    loadLinks();
                } else {
                    document.getElementById('msg').innerText = "Sai t√†i kho·∫£n!";
                }
            });
        }

        function addLink() {
            const title = document.getElementById('linkTitle').value;
            const url = document.getElementById('linkUrl').value;
            const cate = document.getElementById('linkCategory').value;

            if(!title || !url) return alert("Vui l√≤ng nh·∫≠p ƒë·ªß!");

            const btn = document.querySelector('button[onclick="addLink()"]');
            btn.innerText = "ƒêang l∆∞u...";
            btn.disabled = true;

            const fd = new FormData();
            fd.append('action', 'addLink');
            fd.append('title', title);
            fd.append('url', url);
            fd.append('category', cate);

            fetch(SCRIPT_URL, { method: 'POST', body: fd })
            .then(() => {
                alert("ƒê√£ l∆∞u!");
                document.getElementById('linkTitle').value = "";
                document.getElementById('linkUrl').value = "";
                btn.innerText = "üíæ L∆∞u Link";
                btn.disabled = false;
                loadLinks(); // T·∫£i l·∫°i danh s√°ch
            });
        }

        function loadLinks() {
            fetch(SCRIPT_URL + '?action=getLinks')
            .then(res => res.json())
            .then(data => {
                const list = document.getElementById('link-list');
                list.innerHTML = "";
                if(data.length === 0) return list.innerHTML = "<p>Ch∆∞a c√≥ link n√†o.</p>";

                data.forEach(row => {
                    // row[1]=Title, row[2]=URL, row[3]=Category, row[5]=RowIndex (do push th√™m)
                    // L∆∞u √Ω: row[5] l√† ch·ªâ s·ªë d√≤ng m√¨nh push v√†o ·ªü server
                    
                    list.innerHTML += `
                        <div class="link-card">
                            <div class="link-info">
                                <h3>${row[1]}</h3>
                                <div class="link-meta">
                                    <span class="tag">${row[3]}</span> 
                                    ${new Date(row[0]).toLocaleDateString()}
                                </div>
                            </div>
                            <div class="actions">
                                <a href="${row[2]}" target="_blank">M·ªü ‚Üó</a>
                                <button class="btn-del" onclick="deleteLink(${row[5]})">X</button>
                            </div>
                        </div>
                    `;
                });
            });
        }

        function deleteLink(rowIndex) {
            if(!confirm("X√≥a link n√†y?")) return;
            
            const fd = new FormData();
            fd.append('action', 'deleteLink');
            fd.append('row', rowIndex);

            fetch(SCRIPT_URL, { method: 'POST', body: fd })
            .then(() => loadLinks());
        }
    </script>

</body>
</html>
