<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link Space üöÄ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
            --text-color: #ffffff;
            --card-hover: rgba(255, 255, 255, 0.25);
            --accent: #ff0080;
        }

        * { 
            box-sizing: border-box; 
            font-family: 'Outfit', sans-serif;
            margin: 0;
            padding: 0;
        }

        body {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            display: flex;
            position: relative;
            transition: background 0.5s ease;
        }

        body.static-bg {
            animation: none;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-position: 50% 50%;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            pointer-events: none;
            animation: float 20s ease-in-out infinite;
        }

        body.static-bg::before {
            animation: none;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* --- GLASSMOPHISM CLASSES --- */
        .glass {
            background: var(--glass-bg);
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }

        .glass::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: 0.5s;
        }

        .glass:hover::before {
            left: 100%;
        }

        /* --- LAYOUT --- */
        .sidebar {
            width: 280px;
            height: 96vh;
            margin: 2vh 0 2vh 2vh;
            padding: 25px;
            display: flex;
            flex-direction: column;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
            animation: slideInLeft 0.6s ease-out;
        }

        .main {
            flex: 1;
            height: 100vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
        }

        /* --- SIDEBAR COMPONENTS --- */
        .brand {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 50px;
            display: flex; align-items: center; gap: 12px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
            animation: scaleIn 0.5s ease-out;
        }

        .brand i {
            animation: float 3s ease-in-out infinite;
        }

        .menu-item {
            padding: 16px 22px;
            margin-bottom: 10px;
            cursor: pointer;
            border-radius: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; align-items: center; gap: 15px;
            color: rgba(255,255,255,0.7);
            font-weight: 600;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            left: 0; top: 0;
            width: 4px; height: 100%;
            background: white;
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .menu-item:hover, .menu-item.active {
            background: rgba(255,255,255,0.25);
            color: white;
            transform: translateX(8px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .menu-item.active::before {
            transform: scaleY(1);
        }

        .menu-item i {
            font-size: 1.1rem;
            transition: transform 0.3s ease;
        }

        .menu-item:hover i {
            transform: scale(1.2) rotate(5deg);
        }
        
        .user-panel {
            margin-top: auto;
            padding-top: 25px;
            border-top: 1px solid rgba(255,255,255,0.15);
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            animation: fadeInUp 0.6s ease-out 0.3s backwards;
        }

        .user-panel button {
            transition: all 0.3s ease;
        }

        .user-panel button:hover {
            transform: rotate(90deg) scale(1.2);
        }

        /* --- TOP BAR & SEARCH --- */
        .top-bar {
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 30px;
            gap: 15px;
        }
        
        .search-box {
            position: relative;
            width: 320px;
        }

        .search-box input {
            width: 100%;
            padding: 14px 22px 14px 50px;
            border-radius: 30px;
            border: 2px solid rgba(255,255,255,0.2);
            outline: none;
            background: rgba(255,255,255,0.15);
            color: white;
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.95rem;
        }

        .search-box input::placeholder { 
            color: rgba(255,255,255,0.6); 
        }

        .search-box input:focus { 
            background: rgba(255,255,255,0.25); 
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.4);
            transform: translateY(-2px);
        }

        .search-icon {
            position: absolute; 
            left: 18px; 
            top: 50%; 
            transform: translateY(-50%);
            color: rgba(255,255,255,0.7);
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .search-box:focus-within .search-icon {
            color: white;
            transform: translateY(-50%) scale(1.1);
        }

        .btn-add {
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            color: #e73c7e;
            border: none; 
            padding: 14px 28px;
            border-radius: 30px;
            font-weight: 700; 
            font-size: 0.95rem;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; 
            align-items: center; 
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn-add::before {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 0; height: 0;
            border-radius: 50%;
            background: rgba(231, 60, 126, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-add:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-add:hover { 
            transform: translateY(-4px) scale(1.05); 
            box-shadow: 0 12px 35px rgba(0,0,0,0.25);
        }

        .btn-add:active {
            transform: translateY(-2px) scale(1.02);
        }

        .btn-add i {
            position: relative;
            z-index: 1;
        }

        .btn-add span {
            position: relative;
            z-index: 1;
        }

        /* --- GRID CARDS --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            padding-bottom: 80px;
            animation: fadeInUp 0.6s ease-out;
        }

        .card {
            padding: 24px;
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; 
            flex-direction: column;
            overflow: hidden;
            animation: fadeInUp 0.5s ease-out backwards;
            animation-delay: calc(var(--card-index, 0) * 0.05s);
        }

        .card::after {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            background: var(--card-hover);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .card:hover::after {
            opacity: 1;
        }
        
        .card-header { 
            display: flex; 
            gap: 16px; 
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
        }

        .card-icon { 
            width: 56px; 
            height: 56px; 
            border-radius: 16px; 
            object-fit: cover; 
            background: white; 
            padding: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: transform 0.3s ease;
        }

        .card:hover .card-icon {
            transform: rotate(5deg) scale(1.1);
        }

        .card-title { 
            font-weight: 700; 
            font-size: 1.15rem; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            max-width: 180px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .card-tag { 
            font-size: 0.75rem; 
            background: rgba(255,255,255,0.25); 
            padding: 4px 12px; 
            border-radius: 20px; 
            display: inline-block; 
            margin-top: 6px;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .card:hover .card-tag {
            background: rgba(255,255,255,0.35);
            transform: translateX(5px);
        }
        
        .card-desc {
            font-size: 0.9rem; 
            color: rgba(255,255,255,0.8);
            margin-bottom: 18px;
            display: -webkit-box; 
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical; 
            overflow: hidden;
            height: 2.8em; 
            line-height: 1.4em;
            position: relative;
            z-index: 1;
        }

        .card-actions {
            margin-top: auto;
            display: flex; 
            justify-content: space-between;
            border-top: 1px solid rgba(255,255,255,0.15);
            padding-top: 16px;
            position: relative;
            z-index: 1;
        }

        .action-btn {
            background: none; 
            border: none; 
            color: rgba(255,255,255,0.7);
            cursor: pointer; 
            font-size: 1.05rem; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 36px; 
            height: 36px; 
            border-radius: 50%;
            display: flex; 
            align-items: center; 
            justify-content: center;
            position: relative;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            transform: scale(0);
            transition: transform 0.3s ease;
        }

        .action-btn:hover::before {
            transform: scale(1);
        }

        .action-btn:hover { 
            color: white;
            transform: translateY(-2px) scale(1.1);
        }

        .action-btn i {
            position: relative;
            z-index: 1;
        }

        .action-btn.del:hover::before { 
            background: #ff4757;
        }

        .action-btn.del:hover {
            color: white;
        }

        /* --- LOGIN & MODAL --- */
        .overlay-screen {
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); 
            backdrop-filter: blur(20px);
            z-index: 999; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            opacity: 0; 
            pointer-events: none; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .overlay-screen.active { 
            opacity: 1; 
            pointer-events: all; 
        }

        .modal-box {
            background: white; 
            color: #333;
            width: 480px; 
            max-width: 90vw;
            padding: 40px;
            border-radius: 24px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.4);
            transform: scale(0.8) translateY(30px); 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .modal-box::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 4px;
            background: linear-gradient(90deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 200% 100%;
            animation: gradientBG 3s ease infinite;
        }

        .overlay-screen.active .modal-box { 
            transform: scale(1) translateY(0); 
        }

        .inp-group { 
            margin-bottom: 20px; 
        }

        .inp-control {
            width: 100%; 
            padding: 14px 16px; 
            border: 2px solid #e0e0e0;
            border-radius: 12px; 
            font-size: 1rem; 
            outline: none; 
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .inp-control:focus { 
            border-color: var(--accent); 
            box-shadow: 0 0 0 4px rgba(255, 0, 128, 0.1);
            background: white;
            transform: translateY(-2px);
        }

        .inp-control:hover {
            border-color: #c0c0c0;
        }
        
        .btn-primary {
            width: 100%; 
            padding: 14px; 
            border: none; 
            border-radius: 12px;
            background: linear-gradient(135deg, #e73c7e 0%, #ee7752 100%);
            color: white; 
            font-weight: 700; 
            cursor: pointer; 
            font-size: 1.05rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(231, 60, 126, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover { 
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(231, 60, 126, 0.4);
        }

        .btn-primary:active {
            transform: translateY(-1px);
        }

        /* --- TOAST --- */
        #toast {
            position: fixed; 
            bottom: 30px; 
            right: 30px;
            background: linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(30,30,30,0.9) 100%);
            backdrop-filter: blur(10px);
            color: white;
            padding: 16px 28px; 
            border-radius: 50px;
            display: flex; 
            align-items: center; 
            gap: 12px;
            transform: translateX(400px); 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        #toast.show { 
            transform: translateX(0);
        }

        #toast i {
            font-size: 1.2rem;
            animation: scaleIn 0.5s ease;
        }

        /* MOBILE */
        .menu-toggle { 
            display: none; 
            color: white; 
            font-size: 1.5rem; 
            cursor: pointer; 
            margin-right: 15px;
            transition: transform 0.3s ease;
        }

        .menu-toggle:hover {
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .sidebar { 
                position: fixed; 
                left: -320px; 
                height: 100vh; 
                margin: 0; 
                border-radius: 0;
                width: 280px;
            }
            .sidebar.open { 
                left: 0; 
                box-shadow: 10px 0 40px rgba(0,0,0,0.5); 
            }
            .menu-toggle { display: block; }
            .main { padding: 20px 15px; }
            .grid { 
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .search-box {
                width: 180px;
            }
            .btn-add span {
                display: none;
            }
            .btn-add {
                padding: 14px;
                border-radius: 50%;
                width: 50px;
                height: 50px;
            }
            .bg-toggle {
                display: none;
            }
            .modal-box {
                padding: 30px 20px;
            }
        }

        @media (max-width: 480px) {
            .search-box {
                width: 150px;
            }
            .card {
                padding: 20px;
            }
        }

        /* --- TOGGLE BUTTON --- */
        .bg-toggle {
            width: 46px;
            height: 46px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }

        .bg-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.15) rotate(180deg);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .bg-toggle i {
            color: white;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .bg-toggle.active {
            background: rgba(255, 255, 255, 0.9);
        }

        .bg-toggle.active i {
            color: #e73c7e;
        }

        @media (max-width: 768px) {
            .bg-toggle {
                width: 42px;
                height: 42px;
            }
            .bg-toggle i {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

    <div id="login-overlay" class="overlay-screen active" style="z-index: 2000;">
        <div class="modal-box glass" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; text-align: center;">
            <h1 style="margin-bottom: 5px;">Link Space ü™ê</h1>
            <p style="margin-bottom: 25px; opacity: 0.8;">Kho l∆∞u tr·ªØ v≈© tr·ª• c·ªßa b·∫°n</p>
            <input type="text" id="u" class="inp-control" placeholder="T√™n ƒëƒÉng nh·∫≠p" style="background:rgba(255,255,255,0.2); border:none; color:white; margin-bottom:10px;">
            <input type="password" id="p" class="inp-control" placeholder="M·∫≠t kh·∫©u" style="background:rgba(255,255,255,0.2); border:none; color:white; margin-bottom:20px;">
            <button class="btn-primary" onclick="app.login()">Kh·ªüi ƒë·ªông t√†u v≈© tr·ª• üöÄ</button>
            <p id="login-msg" style="color:#ff6b81; margin-top:10px; font-size:0.9rem"></p>
        </div>
    </div>

    <div class="sidebar glass" id="sidebar">
        <div class="brand"><i class="fas fa-meteor"></i> Link Space</div>
        
        <div id="menu-list">
            <div class="menu-item active" onclick="app.filter('all', this)"><i class="fas fa-globe"></i> T·∫•t c·∫£</div>
            <div class="menu-item" onclick="app.filter('C√¥ng vi·ªác', this)"><i class="fas fa-briefcase"></i> C√¥ng vi·ªác</div>
            <div class="menu-item" onclick="app.filter('H·ªçc t·∫≠p', this)"><i class="fas fa-book"></i> H·ªçc t·∫≠p</div>
            <div class="menu-item" onclick="app.filter('Gi·∫£i tr√≠', this)"><i class="fas fa-gamepad"></i> Gi·∫£i tr√≠</div>
            <div class="menu-item" onclick="app.filter('T√†i li·ªáu', this)"><i class="fas fa-folder"></i> T√†i li·ªáu</div>
            <div class="menu-item" onclick="app.filter('Kh√°c', this)"><i class="fas fa-star"></i> Kh√°c</div>
        </div>

        <div class="user-panel">
            <div style="display:flex; align-items:center; gap:10px">
                <div style="width:35px; height:35px; background:rgba(255,255,255,0.3); border-radius:50%; display:flex; align-items:center; justify-content:center"><i class="fas fa-user-astronaut"></i></div>
                <span id="user-display" style="font-weight:bold">Guest</span>
            </div>
            <button onclick="location.reload()" style="background:none; border:none; color:#ff6b81; cursor:pointer"><i class="fas fa-power-off"></i></button>
        </div>
    </div>

    <div class="main">
        <div class="top-bar">
            <div style="display:flex; align-items:center; gap:15px; flex:1;">
                <i class="fas fa-bars menu-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')"></i>
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="search-inp" placeholder="T√¨m ki·∫øm link..." onkeyup="app.search()">
                </div>
            </div>
            <div style="display:flex; align-items:center; gap:12px;">
                <div class="bg-toggle" id="bg-toggle" onclick="app.toggleBg()" title="B·∫≠t/T·∫Øt n·ªÅn ƒë·ªông">
                    <i class="fas fa-play"></i>
                </div>
                <button class="btn-add" onclick="app.openModal()"><i class="fas fa-plus"></i><span>Th√™m m·ªõi</span></button>
            </div>
        </div>

        <div class="grid" id="grid">
            </div>
    </div>

    <div id="modal-overlay" class="overlay-screen">
        <div class="modal-box">
            <h2 id="modal-title" style="margin-top:0; color: #333;">Th√™m Link M·ªõi</h2>
            
            <div class="inp-group" style="display:flex; gap:10px">
                <input type="text" id="inp-url" class="inp-control" placeholder="D√°n URL (https://...)" onchange="app.fetchMeta()">
                <button onclick="app.fetchMeta()" class="btn-primary" style="width:50px; display:flex; align-items:center; justify-content:center">‚ö°</button>
            </div>
            <div class="inp-group"><input type="text" id="inp-title" class="inp-control" placeholder="Ti√™u ƒë·ªÅ"></div>
            <div class="inp-group">
                <select id="inp-cate" class="inp-control">
                    <option value="C√¥ng vi·ªác">üíº C√¥ng vi·ªác</option>
                    <option value="H·ªçc t·∫≠p">üìö H·ªçc t·∫≠p</option>
                    <option value="Gi·∫£i tr√≠">üé¨ Gi·∫£i tr√≠</option>
                    <option value="T√†i li·ªáu">üìÇ T√†i li·ªáu</option>
                    <option value="Kh√°c">‚ú® Kh√°c</option>
                </select>
            </div>
            <div class="inp-group"><textarea id="inp-desc" class="inp-control" rows="3" placeholder="M√¥ t·∫£..."></textarea></div>

            <input type="hidden" id="inp-icon">
            <input type="hidden" id="inp-row">

            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
                <button onclick="document.getElementById('modal-overlay').classList.remove('active')" style="background:#eee; color:#333; padding:10px 20px; border:none; border-radius:8px; cursor:pointer">H·ªßy</button>
                <button onclick="app.saveLink()" id="btn-save" class="btn-primary" style="width:auto">L∆∞u l·∫°i</button>
            </div>
        </div>
    </div>

    <div id="toast"><i class="fas fa-check-circle" style="color:#2ecc71"></i> <span id="toast-msg">Th√†nh c√¥ng</span></div>

    <script>
        // --- D√ÅN URL API C·ª¶A B·∫†N V√ÄO D∆Ø·ªöI ƒê√ÇY ---
        const API = 'https://script.google.com/macros/s/AKfycbzNix_roJMywRXJHqwNftO0eu86h9i6ZJlPdwkpbE_j3_PA4-EubIF_1lhhJGrRKg8K/exec'; 

        const app = {
            data: [], userMDD: '', isEdit: false, bgAnimated: true,

            login: function() {
                const u = document.getElementById('u').value, p = document.getElementById('p').value;
                const btn = document.querySelector('#login-overlay button');
                btn.innerText = "ƒêang k·∫øt n·ªëi..."; btn.disabled = true;

                const fd = new FormData(); fd.append('action', 'login'); fd.append('user', u); fd.append('pass', p);
                fetch(API, {method:'POST', body:fd}).then(r=>r.json()).then(res=>{
                    if(res.status=='success'){
                        this.userMDD = res.mdd;
                        document.getElementById('user-display').innerText = u;
                        document.getElementById('login-overlay').classList.remove('active');
                        this.loadLinks();
                    } else {
                        document.getElementById('login-msg').innerText = "Sai th√¥ng tin ƒëƒÉng nh·∫≠p!";
                        btn.innerText = "Kh·ªüi ƒë·ªông t√†u v≈© tr·ª• üöÄ"; btn.disabled = false;
                    }
                }).catch(()=> { btn.disabled = false; alert("L·ªói k·∫øt n·ªëi Server"); });
            },

            loadLinks: function() {
                document.getElementById('grid').innerHTML = '<p style="text-align:center; width:100%; color:white; font-size:1.2rem">ƒêang t·∫£i d·ªØ li·ªáu t·ª´ v≈© tr·ª•...</p>';
                fetch(API + '?action=getLinks&mdd=' + this.userMDD).then(r=>r.json()).then(res=>{
                    this.data = res; this.render(this.data);
                });
            },

            render: function(list) {
                const grid = document.getElementById('grid'); grid.innerHTML = "";
                if(list.length==0) { grid.innerHTML = '<p style="text-align:center; width:100%; color:rgba(255,255,255,0.7); font-size:1.1rem">Ch∆∞a c√≥ link n√†o. H√£y th√™m link ƒë·∫ßu ti√™n! üöÄ</p>'; return;}
                
                list.forEach((i, index) => {
                    // i: [0]Time, [1]Title, [2]Url, [3]Cate, [4]Stat, [5]MDD, [6]Desc, [7]Icon, [8]Row
                    const icon = i[7] || "https://cdn-icons-png.flaticon.com/512/1006/1006771.png";
                    grid.innerHTML += `
                        <div class="card glass" style="--card-index: ${index}">
                            <div class="card-header">
                                <img src="${icon}" class="card-icon" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1006/1006771.png'">
                                <div style="flex:1; overflow:hidden">
                                    <div class="card-title" title="${i[1]}">${i[1]}</div>
                                    <span class="card-tag">${i[3]}</span>
                                </div>
                            </div>
                            <div class="card-desc">${i[6] || 'Kh√¥ng c√≥ m√¥ t·∫£'}</div>
                            <div class="card-actions">
                                <div>
                                    <a href="${i[2]}" target="_blank" class="action-btn" title="M·ªü"><i class="fas fa-external-link-alt"></i></a>
                                </div>
                                <div style="display:flex; gap:5px">
                                    <button onclick="app.copyLink('${i[2]}')" class="action-btn" title="Copy"><i class="fas fa-copy"></i></button>
                                    <button onclick="app.editModal(${i[8]})" class="action-btn" title="S·ª≠a"><i class="fas fa-pen"></i></button>
                                    <button onclick="app.deleteLink(${i[8]})" class="action-btn del" title="X√≥a"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            },

            filter: function(c, el) {
                document.querySelectorAll('.menu-item').forEach(e=>e.classList.remove('active'));
                el.classList.add('active');
                this.render(c=='all' ? this.data : this.data.filter(x=>x[3]==c));
            },

            search: function() {
                const k = document.getElementById('search-inp').value.toLowerCase();
                this.render(this.data.filter(x => String(x[1]).toLowerCase().includes(k) || String(x[2]).toLowerCase().includes(k)));
            },

            openModal: function() {
                this.isEdit = false;
                document.getElementById('modal-title').innerText = "Th√™m Link M·ªõi";
                ['inp-url','inp-title','inp-desc','inp-icon'].forEach(id=>document.getElementById(id).value="");
                document.getElementById('modal-overlay').classList.add('active');
            },

            editModal: function(row) {
                const item = this.data.find(x=>x[8]==row);
                if(!item) return;
                this.isEdit = true;
                document.getElementById('modal-title').innerText = "C·∫≠p Nh·∫≠t Link";
                document.getElementById('inp-row').value = row;
                document.getElementById('inp-title').value = item[1];
                document.getElementById('inp-url').value = item[2];
                document.getElementById('inp-cate').value = item[3];
                document.getElementById('inp-desc').value = item[6];
                document.getElementById('inp-icon').value = item[7];
                document.getElementById('modal-overlay').classList.add('active');
            },

            fetchMeta: function() {
                const url = document.getElementById('inp-url').value;
                if(url.length < 5) return;
                const btn = document.querySelector('.inp-group button');
                btn.innerHTML = "<i class='fas fa-spinner fa-spin'></i>";
                
                const fd = new FormData(); fd.append('action', 'fetchMeta'); fd.append('url', url);
                fetch(API, {method:'POST', body:fd}).then(r=>r.json()).then(res=>{
                    btn.innerHTML = "‚ö°";
                    if(res.status=='success'){
                        document.getElementById('inp-title').value = res.title;
                        document.getElementById('inp-desc').value = res.description;
                        document.getElementById('inp-icon').value = res.icon;
                        this.toast("ƒê√£ l·∫•y th√¥ng tin!");
                    }
                });
            },

            saveLink: function() {
                const u = document.getElementById('inp-url').value, t = document.getElementById('inp-title').value;
                if(!u || !t) return alert("Thi·∫øu URL ho·∫∑c Ti√™u ƒë·ªÅ");
                
                const btn = document.getElementById('btn-save'); btn.innerText = "L∆∞u..."; btn.disabled = true;
                const fd = new FormData();
                fd.append('mdd', this.userMDD); fd.append('url', u); fd.append('title', t);
                fd.append('category', document.getElementById('inp-cate').value);
                fd.append('desc', document.getElementById('inp-desc').value);
                fd.append('icon', document.getElementById('inp-icon').value);
                
                if(this.isEdit) { fd.append('action', 'editLink'); fd.append('row', document.getElementById('inp-row').value); }
                else fd.append('action', 'addLink');

                fetch(API, {method:'POST', body:fd}).then(()=>{
                    this.toast("ƒê√£ l∆∞u th√†nh c√¥ng!");
                    document.getElementById('modal-overlay').classList.remove('active');
                    btn.innerText = "L∆∞u l·∫°i"; btn.disabled = false;
                    this.loadLinks();
                });
            },

            deleteLink: function(r) {
                if(!confirm("X√≥a link n√†y?")) return;
                this.data = this.data.filter(x=>x[8]!=r); this.render(this.data); // Optimistic update
                const fd = new FormData(); fd.append('action', 'deleteLink'); fd.append('row', r);
                fetch(API, {method:'POST', body:fd});
                this.toast("ƒê√£ x√≥a link");
            },

            copyLink: function(t) { navigator.clipboard.writeText(t); this.toast("ƒê√£ copy link!"); },

            toast: function(m) {
                const t = document.getElementById('toast');
                document.getElementById('toast-msg').innerText = m;
                t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 3000);
            },

            toggleBg: function() {
                this.bgAnimated = !this.bgAnimated;
                const body = document.body;
                const btn = document.getElementById('bg-toggle');
                const icon = btn.querySelector('i');
                
                if (this.bgAnimated) {
                    body.classList.remove('static-bg');
                    btn.classList.remove('active');
                    icon.className = 'fas fa-play';
                    this.toast('N·ªÅn ƒë·ªông ƒë√£ b·∫≠t üé®');
                } else {
                    body.classList.add('static-bg');
                    btn.classList.add('active');
                    icon.className = 'fas fa-pause';
                    this.toast('N·ªÅn ƒë·ªông ƒë√£ t·∫Øt ‚è∏Ô∏è');
                }
                
                // L∆∞u tr·∫°ng th√°i v√†o localStorage
                localStorage.setItem('bgAnimated', this.bgAnimated);
            },

            initBgState: function() {
                // Kh√¥i ph·ª•c tr·∫°ng th√°i t·ª´ localStorage
                const saved = localStorage.getItem('bgAnimated');
                if (saved !== null) {
                    this.bgAnimated = saved === 'true';
                    if (!this.bgAnimated) {
                        document.body.classList.add('static-bg');
                        const btn = document.getElementById('bg-toggle');
                        btn.classList.add('active');
                        btn.querySelector('i').className = 'fas fa-pause';
                    }
                }
            }
        };

        // Kh·ªüi t·∫°o tr·∫°ng th√°i n·ªÅn khi trang load
        window.addEventListener('DOMContentLoaded', () => {
            app.initBgState();
        });
    </script>
</body>
</html>
